<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <meta name="generator" content="Hugo 0.101.0" />
  <link rel="canonical" href="http://3implieschaos.org/post/tech/comp_sci/headless-python-selenium-with-behave/" />

  
    
    <meta name="description" content="Selenium Testing a Web App can be a quick and productive win.">
  

  <link rel="apple-touch-icon" sizes="180x180" href="http://3implieschaos.org/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="http://3implieschaos.org/favicon-32x32.png"> 
  <link rel="icon" type="image/png" sizes="16x16" href="http://3implieschaos.org/favicon-16x16.png"> 
  <link rel="manifest" href="http://3implieschaos.org/site.webmanifest"> 
  <link rel="mask-icon" href="http://3implieschaos.org/safari-pinned-tab.svg" color="#000000"> 
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="theme-color" content="#ffffff">

  <style>
    body {
      visibility: hidden;
      opacity: 0;
    }
  </style>

  <style id="darkTheme">
    .intro-and-nav,
    .main-and-footer {
      filter: invert(100%);
    }

    * {
      background-color: inherit
    }

    img:not([src*=".svg"]),
    .colors,
    iframe,
    .demo-container {
      filter: invert(100%);
    }
  </style>

  <link rel="stylesheet" href="/css/prism.css" media="none" onload="this.media='all';">

  
  
  <link rel="stylesheet" type="text/css" href="/css/styles.css">

  

  
  
  <title>Headless Python Selenium With Behave | tdj28</title>
</head>

  <body>
    <a href="#main">skip to content</a>
    <noscript>
  <style>
    body {
      visibility: visible;
      opacity: 1;
    }
  </style>
</noscript>

    <svg style="display: none">
  <symbol id="bookmark" viewBox="0 0 40 50">
   <g transform="translate(2266 3206.2)">
    <path style="stroke:currentColor;stroke-width:3.2637;fill:none" d="m-2262.2-3203.4-.2331 42.195 16.319-16.318 16.318 16.318.2331-42.428z"/>
   </g>
  </symbol>

  <symbol id="w3c" viewBox="0 0 127.09899 67.763">
   <text font-size="83" style="font-size:83px;font-family:Trebuchet;letter-spacing:-12;fill-opacity:0" letter-spacing="-12" y="67.609352" x="-26.782778">W3C</text>
   <text font-size="83" style="font-size:83px;font-weight:bold;font-family:Trebuchet;fill-opacity:0" y="67.609352" x="153.21722" font-weight="bold">SVG</text>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m33.695.377 12.062 41.016 12.067-41.016h8.731l-19.968 67.386h-.831l-12.48-41.759-12.479 41.759h-.832l-19.965-67.386h8.736l12.061 41.016 8.154-27.618-3.993-13.397h8.737z"/>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m91.355 46.132c0 6.104-1.624 11.234-4.862 15.394-3.248 4.158-7.45 6.237-12.607 6.237-3.882 0-7.263-1.238-10.148-3.702-2.885-2.47-5.02-5.812-6.406-10.022l6.82-2.829c1.001 2.552 2.317 4.562 3.953 6.028 1.636 1.469 3.56 2.207 5.781 2.207 2.329 0 4.3-1.306 5.909-3.911 1.609-2.606 2.411-5.738 2.411-9.401 0-4.049-.861-7.179-2.582-9.399-1.995-2.604-5.129-3.912-9.397-3.912h-3.327v-3.991l11.646-20.133h-14.062l-3.911 6.655h-2.493v-14.976h32.441v4.075l-12.31 21.217c4.324 1.385 7.596 3.911 9.815 7.571 2.22 3.659 3.329 7.953 3.329 12.892z"/>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m125.21 0 1.414 8.6-5.008 9.583s-1.924-4.064-5.117-6.314c-2.693-1.899-4.447-2.309-7.186-1.746-3.527.73-7.516 4.938-9.258 10.13-2.084 6.21-2.104 9.218-2.178 11.978-.115 4.428.58 7.043.58 7.043s-3.04-5.626-3.011-13.866c.018-5.882.947-11.218 3.666-16.479 2.404-4.627 5.954-7.404 9.114-7.728 3.264-.343 5.848 1.229 7.841 2.938 2.089 1.788 4.213 5.698 4.213 5.698l4.94-9.837z"/>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m125.82 48.674s-2.208 3.957-3.589 5.48c-1.379 1.524-3.849 4.209-6.896 5.555-3.049 1.343-4.646 1.598-7.661 1.306-3.01-.29-5.807-2.032-6.786-2.764-.979-.722-3.486-2.864-4.897-4.854-1.42-2-3.634-5.995-3.634-5.995s1.233 4.001 2.007 5.699c.442.977 1.81 3.965 3.749 6.572 1.805 2.425 5.315 6.604 10.652 7.545 5.336.945 9.002-1.449 9.907-2.031.907-.578 2.819-2.178 4.032-3.475 1.264-1.351 2.459-3.079 3.116-4.108.487-.758 1.276-2.286 1.276-2.286l-1.276-6.644z"/>
  </symbol>

  <symbol id="tag" viewBox="0 0 177.16535 177.16535">
    <g transform="translate(0 -875.2)">
     <path style="fill-rule:evenodd;stroke-width:0;fill:currentColor" d="m159.9 894.3-68.79 8.5872-75.42 77.336 61.931 60.397 75.429-76.565 6.8495-69.755zm-31.412 31.835a10.813 10.813 0 0 1 1.8443 2.247 10.813 10.813 0 0 1 -3.5174 14.872l-.0445.0275a10.813 10.813 0 0 1 -14.86 -3.5714 10.813 10.813 0 0 1 3.5563 -14.863 10.813 10.813 0 0 1 13.022 1.2884z"/>
    </g>
  </symbol>

  <symbol id="balloon" viewBox="0 0 141.73228 177.16535">
   <g transform="translate(0 -875.2)">
    <g>
     <path style="fill:currentColor" d="m68.156 882.83-.88753 1.4269c-4.9564 7.9666-6.3764 17.321-5.6731 37.378.36584 10.437 1.1246 23.51 1.6874 29.062.38895 3.8372 3.8278 32.454 4.6105 38.459 4.6694-.24176 9.2946.2879 14.377 1.481 1.2359-3.2937 5.2496-13.088 8.886-21.623 6.249-14.668 8.4128-21.264 10.253-31.252 1.2464-6.7626 1.6341-12.156 1.4204-19.764-.36325-12.93-2.1234-19.487-6.9377-25.843-2.0833-2.7507-6.9865-7.6112-7.9127-7.8436-.79716-.20019-6.6946-1.0922-6.7755-1.0248-.02213.0182-5.0006-.41858-7.5248-.22808l-2.149-.22808h-3.3738z"/>
     <path style="fill:currentColor" d="m61.915 883.28-3.2484.4497c-1.7863.24724-3.5182.53481-3.8494.63994-2.4751.33811-4.7267.86957-6.7777 1.5696-.28598 0-1.0254.20146-2.3695.58589-5.0418 1.4418-6.6374 2.2604-8.2567 4.2364-6.281 7.6657-11.457 18.43-12.932 26.891-1.4667 8.4111.71353 22.583 5.0764 32.996 3.8064 9.0852 13.569 25.149 22.801 37.517 1.3741 1.841 2.1708 2.9286 2.4712 3.5792 3.5437-1.1699 6.8496-1.9336 10.082-2.3263-1.3569-5.7831-4.6968-21.86-6.8361-33.002-.92884-4.8368-2.4692-14.322-3.2452-19.991-.68557-5.0083-.77707-6.9534-.74159-15.791.04316-10.803.41822-16.162 1.5026-21.503 1.4593-5.9026 3.3494-11.077 6.3247-15.852z"/>
     <path style="fill:currentColor" d="m94.499 885.78c-.10214-.0109-.13691 0-.0907.0409.16033.13489 1.329 1.0675 2.5976 2.0723 6.7003 5.307 11.273 14.568 12.658 25.638.52519 4.1949.24765 14.361-.5059 18.523-2.4775 13.684-9.7807 32.345-20.944 53.519l-3.0559 5.7971c2.8082.76579 5.7915 1.727 8.9926 2.8441 11.562-11.691 18.349-19.678 24.129-28.394 7.8992-11.913 11.132-20.234 12.24-31.518.98442-10.02-1.5579-20.876-6.7799-28.959-.2758-.4269-.57803-.86856-.89617-1.3166-3.247-6.13-9.752-12.053-21.264-16.131-2.3687-.86369-6.3657-2.0433-7.0802-2.1166z"/>
     <path style="fill:currentColor" d="m32.52 892.22c-.20090-.13016-1.4606.81389-3.9132 2.7457-11.486 9.0476-17.632 24.186-16.078 39.61.79699 7.9138 2.4066 13.505 5.9184 20.562 5.8577 11.77 14.749 23.219 30.087 38.74.05838.059.12188.1244.18052.1838 1.3166-.5556 2.5965-1.0618 3.8429-1.5199-.66408-.32448-1.4608-1.3297-3.8116-4.4602-5.0951-6.785-8.7512-11.962-13.051-18.486-5.1379-7.7948-5.0097-7.5894-8.0586-13.054-6.2097-11.13-8.2674-17.725-8.6014-27.563-.21552-6.3494.13041-9.2733 1.775-14.987 2.1832-7.5849 3.9273-10.986 9.2693-18.07 1.7839-2.3656 2.6418-3.57 2.4409-3.7003z"/>
     <path style="fill:currentColor" d="m69.133 992.37c-6.2405.0309-12.635.76718-19.554 2.5706 4.6956 4.7759 9.935 10.258 12.05 12.625l4.1272 4.6202h11.493l3.964-4.4516c2.0962-2.3541 7.4804-7.9845 12.201-12.768-8.378-1.4975-16.207-2.6353-24.281-2.5955z"/>
     <rect style="stroke-width:0;fill:currentColor" ry="2.0328" height="27.746" width="22.766" y="1017.7" x="60.201"/>
    </g>
   </g>
  </symbol>

  <symbol id="info" viewBox="0 0 41.667 41.667">
   <g transform="translate(-37.035 -1004.6)">
    <path style="stroke-linejoin:round;stroke:currentColor;stroke-linecap:round;stroke-width:3.728;fill:none" d="m76.25 1030.2a18.968 18.968 0 0 1 -23.037 13.709 18.968 18.968 0 0 1 -13.738 -23.019 18.968 18.968 0 0 1 23.001 -13.768 18.968 18.968 0 0 1 13.798 22.984"/>
    <g transform="matrix(1.1146 0 0 1.1146 -26.276 -124.92)">
     <path style="stroke:currentColor;stroke-linecap:round;stroke-width:3.728;fill:none" d="m75.491 1039.5v-8.7472"/>
     <path style="stroke-width:0;fill:currentColor" transform="scale(-1)" d="m-73.193-1024.5a2.3719 2.3719 0 0 1 -2.8807 1.7142 2.3719 2.3719 0 0 1 -1.718 -2.8785 2.3719 2.3719 0 0 1 2.8763 -1.7217 2.3719 2.3719 0 0 1 1.7254 2.8741"/>
    </g>
   </g>
  </symbol>

  <symbol id="warning" viewBox="0 0 48.430474 41.646302">
    <g transform="translate(-1.1273 -1010.2)">
     <path style="stroke-linejoin:round;stroke:currentColor;stroke-linecap:round;stroke-width:4.151;fill:none" d="m25.343 1012.3-22.14 37.496h44.28z"/>
     <path style="stroke:currentColor;stroke-linecap:round;stroke-width:4.1512;fill:none" d="m25.54 1027.7v8.7472"/>
     <path style="stroke-width:0;fill:currentColor" d="m27.839 1042.8a2.3719 2.3719 0 0 1 -2.8807 1.7143 2.3719 2.3719 0 0 1 -1.718 -2.8785 2.3719 2.3719 0 0 1 2.8763 -1.7217 2.3719 2.3719 0 0 1 1.7254 2.8741"/>
    </g>
  </symbol>

  <symbol id="menu" viewBox="0 0 50 50">
     <rect style="stroke-width:0;fill:currentColor" height="10" width="50" y="0" x="0"/>
     <rect style="stroke-width:0;fill:currentColor" height="10" width="50" y="20" x="0"/>
     <rect style="stroke-width:0;fill:currentColor" height="10" width="50" y="40" x="0"/>
   </symbol>

   <symbol id="link" viewBox="0 0 50 50">
    <g transform="translate(0 -1002.4)">
     <g transform="matrix(.095670 0 0 .095670 2.3233 1004.9)">
      <g>
       <path style="stroke-width:0;fill:currentColor" d="m452.84 192.9-128.65 128.65c-35.535 35.54-93.108 35.54-128.65 0l-42.881-42.886 42.881-42.876 42.884 42.876c11.845 11.822 31.064 11.846 42.886 0l128.64-128.64c11.816-11.831 11.816-31.066 0-42.9l-42.881-42.881c-11.822-11.814-31.064-11.814-42.887 0l-45.928 45.936c-21.292-12.531-45.491-17.905-69.449-16.291l72.501-72.526c35.535-35.521 93.136-35.521 128.64 0l42.886 42.881c35.535 35.523 35.535 93.141-.001 128.66zm-254.28 168.51-45.903 45.9c-11.845 11.846-31.064 11.817-42.881 0l-42.884-42.881c-11.845-11.821-11.845-31.041 0-42.886l128.65-128.65c11.819-11.814 31.069-11.814 42.884 0l42.886 42.886 42.876-42.886-42.876-42.881c-35.54-35.521-93.113-35.521-128.65 0l-128.65 128.64c-35.538 35.545-35.538 93.146 0 128.65l42.883 42.882c35.51 35.54 93.11 35.54 128.65 0l72.496-72.499c-23.956 1.597-48.092-3.784-69.474-16.283z"/>
      </g>
     </g>
    </g>
  </symbol>

  <symbol id="doc" viewBox="0 0 35 45">
   <g transform="translate(-147.53 -539.83)">
    <path style="stroke:currentColor;stroke-width:2.4501;fill:none" d="m149.38 542.67v39.194h31.354v-39.194z"/>
    <g style="stroke-width:25" transform="matrix(.098003 0 0 .098003 133.69 525.96)">
     <path d="m220 252.36h200" style="stroke:currentColor;stroke-width:25;fill:none"/>
     <path style="stroke:currentColor;stroke-width:25;fill:none" d="m220 409.95h200"/>
     <path d="m220 488.74h200" style="stroke:currentColor;stroke-width:25;fill:none"/>
     <path d="m220 331.15h200" style="stroke:currentColor;stroke-width:25;fill:none"/>
    </g>
   </g>
 </symbol>

 <symbol id="tick" viewBox="0 0 177.16535 177.16535">
  <g transform="translate(0 -875.2)">
   <rect style="stroke-width:0;fill:currentColor" transform="rotate(30)" height="155" width="40" y="702.99" x="556.82"/>
   <rect style="stroke-width:0;fill:currentColor" transform="rotate(30)" height="40" width="90.404" y="817.99" x="506.42"/>
  </g>
 </symbol>
</svg>

    <div class="wrapper">
      <header class="intro-and-nav" role="banner">
  <div>
    <div class="intro">
      <a
        class="logo"
        href="http://3implieschaos.org/"
        aria-label="tdj28 home page"
      >
        
          <h1>tdj28</h1>
        
      </a>
      <p class="library-desc">
         Potentially helpful notes, tips, and how-tos. 
      </p>
    </div>
    <nav id="patterns-nav" class="patterns" role="navigation">
  <h2 class="vh">Main navigation</h2>
  <button id="menu-button" aria-expanded="false">
    <svg viewBox="0 0 50 50" aria-hidden="true" focusable="false">
      <use href="#menu"></use>
    </svg>
    Menu
  </button>
  
  <ul id="patterns-list">
  
    <li class="pattern">
      
      
      
      
      <a href="/" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use href="#bookmark"></use>
        </svg>
        <span class="text">Home</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      <a href="/post/" aria-current="page">
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use href="#bookmark"></use>
        </svg>
        <span class="text">Blog</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      <a href="/tags/" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use href="#bookmark"></use>
        </svg>
        <span class="text">Tags</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      <a href="/about/" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use href="#bookmark"></use>
        </svg>
        <span class="text">About</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      <a href="/index.xml" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use href="#bookmark"></use>
        </svg>
        <span class="text">RSS</span>
      </a>
    </li>
  
  </ul>
</nav>
    
  </div>
</header>

      <div class="main-and-footer">
        <div>
          
  <main id="main">
    <h1>
      <svg class="bookmark-icon" aria-hidden="true" viewBox="0 0 40 50" focusable="false">
        <use href="#bookmark"></use>
      </svg>
      Headless Python Selenium With Behave
    </h1>

    <div class="date">
      
      
      <strong>Publish date: </strong>Aug 26, 2018
      
        
      
    </div>

    
      <div class="tags">
        <strong>Tags: </strong>
        <ul aria-label="tags">
          
            <li>
              <svg class="tag-icon" aria-hidden="true" viewBox="0 0 177.16535 177.16535" focusable="false">
                <use href="#tag"></use>
              </svg>
              
              <a href="/tags/python/">python</a>
            </li>
          
            <li>
              <svg class="tag-icon" aria-hidden="true" viewBox="0 0 177.16535 177.16535" focusable="false">
                <use href="#tag"></use>
              </svg>
              
              <a href="/tags/software-testing/">software-testing</a>
            </li>
          
        </ul>
      </div>
    

    
  <nav class="toc" aria-labelledby="toc-heading">
    <strong id="toc-heading">Table of Contents</strong>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#selenium">Selenium</a>
      <ul>
        <li><a href="#headless-on-ubuntu-skip-this-if-using-a-mac">Headless on Ubuntu (skip this if using a Mac)</a></li>
        <li><a href="#our-first-selenium-assertion">Our first selenium assertion</a></li>
        <li><a href="#expanding-the-tests">Expanding the tests</a></li>
        <li><a href="#step-one-define-the-behavior">Step One: Define the Behavior</a></li>
        <li><a href="#step-two-turn-the-behaviors-into-steps">Step Two: Turn the Behaviors Into Steps</a></li>
        <li><a href="#step-three-turn-the-steps-into-implemented-functions">Step Three: Turn the Steps Into Implemented Functions</a></li>
        <li><a href="#step-four-define-the-browser">Step Four: Define The Browser</a></li>
        <li><a href="#step-five-putting-it-all-together">Step Five: Putting it all together</a></li>
        <li><a href="#find-the-code-here">Find the code here</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </nav>



    <p>Testing software can often be seen as the least enjoyable part of the
<a href="https://en.wikipedia.org/wiki/Systems_development_life_cycle">systems development life cycle</a>.
It is easy to see why. Developing the actual application that does the magic
that the end user finds value in is indeed a very exciting core to the process.
And yet, what you produce could be worthless if it doesn&rsquo;t work for the user.</p>
<p>So let&rsquo;s say you are working on an individual pet project. The fun part is
coding it up and getting it to do something. Here, I&rsquo;m going to use a simple
<em>Flask</em> app that serves up some Wikipedia page count stats as an example.
As a developer adds layers and new features and new bells and whistles and
pipes and extension cords to their project, things which they
haven&rsquo;t developed in months or years can break, and if they don&rsquo;t have a good testing
suite in place, they won&rsquo;t catch it and will serve out a degraded experience.
That&rsquo;s a dis-service to their users, but even to themselves, whose hard work
has gone to waste because that piece of the project, which they might have
spent many hours working on, might as well not even exist if it doesn&rsquo;t work.
Worse yet, if they break their app entirely, it could take hours and hours
of searching for a bug.</p>
<p>If instead there is a systematic testing suite in place,
each incremental change can be subjected to a battery of tests that help ensure
that it is safe to continue to the next incremental change. This <em>should not</em> be
the developer clicking through their app and making sure everything looks good.
There are many awesome tools in place that allow for quick automated testing.
Here, we provide a walk through to jump start a web developer on using Python
and the selenium and behave libraries to provide a full browser test of their site.</p>
<h2 id="selenium">Selenium</h2>
<p>Selenium is a Python library that automates testing the final product of
a webpage. Selenium integrates with various browsers and replicates
the behavior that you expect from your users, all while measuring the
response to that behavior against your expectations for how the site, when
in its optimal state, should respond.
It is as easy to install as</p>
<pre><code class="language-bash">pip install selenium nose behave
</code></pre>
<p>Let&rsquo;s start with a very simple example. Suppose you have webpage that
simply serves this up:</p>
<pre><code class="language-html">&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;WikiViz&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;   
        &lt;h1 class=&quot;example&quot;&gt;Hello World!&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>Even if you didn&rsquo;t want to get fancy and set up a nice file structure and
orchestrate your testing with tools such as <code>behave</code> and <code>nose</code>, you
could simply create a very straight-forward python script that runs
the selenium testing you need to ensure that your page is serving
the expected content.</p>
<p>If you are running these locally on your laptop, the following
step isn&rsquo;t necessary, you will just need to make sure you have
Firefox installed. Selenium works with other browsers, but
to keep this simple at first, we will focus on Firefox.</p>
<h3 id="headless-on-ubuntu-skip-this-if-using-a-mac">Headless on Ubuntu (skip this if using a Mac)</h3>
<p>Skip this section if you don&rsquo;t plan to run this on a remote
linux-based server. In this example, I&rsquo;m using my Cloud 9 IDE
account which serves up containers with Ubuntu as the OS.</p>
<p>First we need to isntall the <a href="https://en.wikipedia.org/wiki/Xvfb">Xvfb</a> package:</p>
<pre><code class="language-bash">sudo apt-get install firefox xvfb
</code></pre>
<p>and the PyVirtualDisplay python library:</p>
<pre><code class="language-bash">pip install selenium nose behave PyVirtualDisplay
</code></pre>
<p>Finally, you&rsquo;ll need the <a href="https://github.com/mozilla/geckodriver/releases">geckodriver</a>
(they don&rsquo;t include md5sums or rsa hashes to confirm authenticity, but use github
to host and release which comes with a great deal of trust):</p>
<pre><code class="language-bash">wget https://github.com/mozilla/geckodriver/releases/download/v0.21.0/geckodriver-v0.21.0-linux64.tar.gz
tar zxvf geckodriver-v0.21.0-linux64.tar.gz
chmod a+x geckodriver
sudo mv geckodriver /usr/local/bin/
</code></pre>
<h3 id="our-first-selenium-assertion">Our first selenium assertion</h3>
<p>Now we are ready for our first test. This test will
do two things. First, it will cause selenium to try
to access the webpage. If it can&rsquo;t do so, it will fail.
This means that a selenium tests automatically tells
you whether or not your page is up and running right
out of the box. Secondly, the test will assert that
the very simple webpage example shown above is setting
the title to &lsquo;WikiViz&rsquo; as it should be.</p>
<p>If you are using the headless on your remote server,
your code will look like this:</p>
<pre><code class="language-python">#!/usr/bin/env python

from pyvirtualdisplay import Display
from selenium import webdriver

display = Display(visible=0, size=(1000, 1000))
display.start()

driver = webdriver.Firefox()
driver.get('http://localhost:8080/')
assert driver.title == 'WikiViz'
driver.quit()

display.stop()
</code></pre>
<p>If you are running this in a local environment, such as on
a Mac, and you like to watch selenium open the browser and
walk through the tests, then your code would look like this:</p>
<pre><code class="language-python">from selenium import webdriver

base_url = &quot;http://localhost:8080&quot;
driver = webdriver.Firefox()
driver.get(base_url)

assert driver.title == &quot;WikiViz&quot;
</code></pre>
<p>Yes, it is that easy! OK, well, at least for the title. As
your page gets more complicated, so will your testing, but
overall the spirit of simplicity in the selenium testing scheme
carries over. It&rsquo;s the complexities of html/javascript that
you will eventually need to worry about. But we will keep things
simple here.</p>
<h3 id="expanding-the-tests">Expanding the tests</h3>
<p>In order to make our example just a little more
interesting, and give selenium something to <em>do</em> rather than
just <em>observe</em>, let&rsquo;s add a button to our simple home page
that takes us to another page. Add the following just after
the h1 entry:</p>
<pre><code>&lt;form&gt;
  &lt;input type=&quot;button&quot; value=&quot;results&quot; onclick=&quot;window.location.href='/results'&quot; /&gt;
&lt;/form&gt;
</code></pre>
<p>In this next section, I&rsquo;m going to make the tests a little more
complicated in structure, but for a good payoff. If you like to
keep your tests in a single script as above, you can simply expand
on that script. Here, I will show a simple example using <code>nose</code>
and <code>behave</code> libraries. This example was inspired by a slightly more
complicated (and well done) example (which doesn&rsquo;t have the headless feature)
<a href="https://the-creative-tester.github.io/Python-Web-Browser-Automation-Behave/">here</a>,
but meant to be easier to dive into for those new to testing with selenium.</p>
<p>Create a file structure that looks as follows:</p>
<pre><code class="language-bash">(env) tdj28:~/workspace/selenium_tests (master) $ tree .
.
├── features
│   ├── __init__.py
│   ├── pages
│   │   └── __init__.py
│   └── steps
│       └── __init__.py
└── simple_examples
    └── xvfb_example.py
</code></pre>
<p>here&rsquo;s some bash to make that happen:</p>
<pre><code class="language-bash">mkdir -p selenium_tests/features
mkdir selenium_tests/pages
mkdir selenium_tests/steps
mkdir selenium_tests/simple_examples
touch selenium_tests/features/__init__.py
touch selenium_tests/pages/__init__.py
touch selenium_tests/steps/__init__.py
</code></pre>
<p>The <code>simple_examples</code> directory is where I put in some simple scripts
for testing a few features (or writing this blog post), but you definitely
don&rsquo;t want something that sloppy in a production version of your code.</p>
<p>(Google <code>init python files</code> if you don&rsquo;t know what those <code>__init__.py</code> files
are for.)</p>
<h3 id="step-one-define-the-behavior">Step One: Define the Behavior</h3>
<p>BDD development would have us define behaviors we expect of the site before
we even begin to develop site. That&rsquo;s a good place to start for selenium testing
as well, where if these definitions are pre-existing, we can use them as our starting
point. If not, we can easily create our own.</p>
<p>In the <code>features</code> directory, create a file called <code>clickbutton.feature</code> with
the following content:</p>
<pre><code>Feature: ClickButton

  Scenario: Click Away From Homepage
    Given I navigate to the Home page
    And I see that the pagename is WikiViz
    And I see the header &quot;Hello World!&quot;
    When I click the button
    Then I see that the pagename is no longer WikiViz
</code></pre>
<p>This is the beauty of the <code>behave</code> library and behavior based testing in general.
We can use everyday language to describe our user&rsquo;s experience, and then translate
that in to tests as we will see shortly. This enables non-technical folks to
contribute tests.</p>
<p>Note that in the above tests, the last line entry is a bit of a cheat on my part.
The test really should, in that line, confirm in some way that it made it to the
results page. So don&rsquo;t do what I did there! If for example you click on the button
and it takes you to a 404 error page, your test will still pass. I take that shortcut
here only to keep this jump start example focused on a single simple html page.</p>
<h3 id="step-two-turn-the-behaviors-into-steps">Step Two: Turn the Behaviors Into Steps</h3>
<p>In the steps folder, create a file called <code>clickbutton_step.py</code>. Note that
it has the same prefix <code>clickbutton</code> as the corresponding features file we
created above, that is required for each feature file. The contents of this
file will have:</p>
<pre><code class="language-python">from nose.tools import assert_equal, assert_not_equal, assert_true
from selenium.webdriver.common.by import By

@given('I navigate to the Home page')
def step_impl(context):
    context.home_page.navigate(&quot;http://localhost:8080/&quot;)

@given('I see that the pagename is WikiViz')
def step_impl(context):
    assert_equal(context.home_page.get_page_title(), &quot;WikiViz&quot;)

@given('I see the header &quot;Hello World!&quot;')
def step_impl(context):
    assert_equal(context.home_page.get_page_header(), &quot;Hello World!&quot;)

@when('I click the button')
def step_impl(context):
    context.home_page.click_button()

@then('I see that the pagename is no longer WikiViz')
def step_impl(context):
    assert_not_equal(context.home_page.get_page_title(), &quot;WikiViz&quot;)
</code></pre>
<p>So the pattern here is starting to become clear:</p>
<pre><code>User experience ---&gt; Steps ---&gt; Page functions
</code></pre>
<p>We have chosen to create the steps before the page functions here because that is
a natural way to proceed. The steps will tell you what functions you need to create,
and then afterwards, create those functions with the narrow scope defined by
the steps.</p>
<h3 id="step-three-turn-the-steps-into-implemented-functions">Step Three: Turn the Steps Into Implemented Functions</h3>
<p>Let&rsquo;s stick with our simple home page as detailed above. We
can look behind the curtain of this page by using our browser&rsquo;s
developer console. On Chrome, for example, it is in settings &gt; More Tools &gt;
Developer Tools. This gives you many great tools to inspect
the code and help you locate elements in your code. For our
simple example, that isn&rsquo;t so necessary, but as this example
is expanded to include javascript which makes the page more dynamic,
these developer tools become very useful. In this screenshot below,
for example, we see how it helps us identify elements of the code.</p>
<p><img src="assets/devtools.png" alt="png"></p>
<p>These elements become key as we find key elements to use in our
testing.</p>
<p>In the pages folder, create a file called <code>home_page.py</code> with the following content:</p>
<pre><code>from selenium.webdriver.common.by import By
from browser import Browser


class HomePage(Browser):
    # Home Page Actions

    def navigate(self, address):
        self.driver.get(address)

    def get_page_title(self):
        return self.driver.title

    def get_page_header(self):
        return self.driver.find_element_by_class_name(&quot;example&quot;).text

    def click_button(self, *locator):
        self.driver.find_element_by_class_name(&quot;button&quot;).click()
</code></pre>
<p>Because the source code of our simple page assigns the first and only
h1 header by giving it the class &ldquo;example&rdquo;, that makes it easy
to <code>find_element_by_class_name</code>. If in fact we had multiple h1 elements
with that class, we would have to use the plural <code>find_elements_by_class_name</code>
instead, which returns a list that we could submit for testing (e.g.
we would know what the first h1 should be, the second, etc.).</p>
<p>So for our homepage, we have created the HomePage class, which inherits the
Browser class we created previously, and we define the actions we will
need on this page for testing. When we add other pages to our example
web app in later blog entries, we will create a new file in the pages
folder, one for each page. In this way, we keep the details nice and cleanly
compartmentalized. If we have a subset of pages that share much in common,
we can create a class for that subset, and then have individual pages
inherit that class, and so on.</p>
<p>Also note that there are multiple ways we can identify elements, including
<code>xpath</code>. In this file, we add four tools associated with our homepage.
The first is a navigate function, the second returns the pagename,
the third returns the h1 element, and
the fourth clicks on the button we just added that will send us to a new page.</p>
<h3 id="step-four-define-the-browser">Step Four: Define The Browser</h3>
<p>Before we can make use of the defined behaviors and expectations,
we need to set up our browser and display (for headless).</p>
<p>Create the file <code>features/browser.py</code> with the following content
if you want selenium to run on your laptop or desktop in a way
that you can watch it run through the tests:</p>
<pre><code class="language-python">from selenium import webdriver

class Browser(object):

    driver = webdriver.Firefox()
    driver.implicitly_wait(15)
    driver.set_page_load_timeout(10)
    driver.maximize_window()

    def close(context):
        context.driver.close()
</code></pre>
<p>Here, I&rsquo;ve made the page timeout ten seconds
because if my page is taking longer than ten seconds to load,
to me that is a pretty good reason for it to fail. I would actually
recommend you being more generous than not, and instead build in timing
features to test for load time rather than have the tests timeout as
an indication that your page is slow, but again, this is meant to be
a baseline example.</p>
<p>For those wishing to use headless testing (on a remote server, no live
browser to watch), the above file will look like:</p>
<pre><code class="language-python">from selenium import webdriver
from pyvirtualdisplay import Display  # Comment this out for live browser


class BDisplay(object): # Comment this out for live browser
    display = Display(visible=0, size=(1000, 1000))  # Comment this out for live browser
    display.start()  # Comment this out for live browser

    def stop(context): # Comment this out for live browser
        context.display.stop() # Comment this out for live browser


class Browser(object):

    driver = webdriver.Firefox()
    driver.implicitly_wait(15)
    driver.set_page_load_timeout(10)
    driver.maximize_window()

    def close(context):
        context.driver.close()

</code></pre>
<h3 id="step-five-putting-it-all-together">Step Five: Putting it all together</h3>
<p>Finally, we need to have an environment definition to tie everything together.
This will tell <code>behave</code> what page classes to import and tell it what to
do before and after the tests are ran.</p>
<p>If the <code>features</code> folder, create a file called <code>environment.py</code> with the content:</p>
<pre><code class="language-python">from selenium import webdriver
from browser import BDisplay # Comment this out for live browser
from browser import Browser
from pages.home_page import HomePage


def before_all(context):
    context.display = BDisplay() # Comment this out for live browser
    context.browser = Browser()
    context.home_page = HomePage()


def after_all(context):
    context.browser.close()
    context.display.stop()  # Comment this out for live browser
</code></pre>
<p>In the folder above features, assuming you&rsquo;ve installed <code>behave</code> via pip already,
simply run <code>behave</code>. If all goes well, we get an output that indicates the tests
ran and their pass/fail status:</p>
<pre><code class="language-bash">(env) tdj28:~/workspace/selenium_tests (master) $ behave
Feature: ClickButton # features/clickbutton.feature:1

  Scenario: Click Away From Homepage                  # features/clickbutton.feature:3
    Given I navigate to the Home page                 # features/steps/clickbutton_steps.py:4 0.112s
    And I see that the pagename is WikiViz            # features/steps/clickbutton_steps.py:8 0.005s
    And I see the header &quot;Hello World!&quot;               # features/steps/clickbutton_steps.py:12 0.046s
    When I click the button                           # features/steps/clickbutton_steps.py:16 0.112s
    Then I see that the pagename is no longer WikiViz # features/steps/clickbutton_steps.py:20 0.009s

1 feature passed, 0 failed, 0 skipped
1 scenario passed, 0 failed, 0 skipped
5 steps passed, 0 failed, 0 skipped, 0 undefined
Took 0m0.283s
</code></pre>
<h3 id="find-the-code-here">Find the code here</h3>
<p>For your convenience, the selenium code is
collected <a href="https://github.com/tdj28/wikiviz_demo_selenium/tree/20180826">here</a>.</p>

  </main>
  <div id="disqus-container">
  
</div>


          
            <footer role="contentinfo">
  <div
  
  >
    <label for="themer">
      dark theme: <input type="checkbox" id="themer" class="vh">
      
      <span aria-hidden="true"></span>
    </label>
  </div>
  
    Made with <a href="https://gohugo.io/">Hugo</a>. Themed by <a href="https://github.com/zwbetz-gh/cupper-hugo-theme">Cupper</a>.
  
</footer>

          
        </div>
      </div>
    </div>
    

<script src="/js/dom-scripts.js"></script>  

<script src="/js/prism.js"></script>



<script src="/js/search.7aef046a0cc8b0c532f1d20087b920459bc868c936bb48a6ae221eceefca2d07.js"></script>

<link rel="stylesheet" href="/css/search.fe0cd54a21628574bff49d721c827d1bb165ab56b0f22dd55ae78addbe61c309.css"></link>




    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css" integrity="sha384-dbVIfZGuN1Yq7/1Ocstc1lUEm+AT+/rCkibIcC/OmWo5f0EA48Vf8CytHzGrSwbQ" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js" integrity="sha384-2BKqo+exmr9su6dir+qCw08N2ZKRucY4PrGQPPWU1A7FtlCGjmEGFqXCv5nyM5Ij" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>

    
  

  </body>
</html>
